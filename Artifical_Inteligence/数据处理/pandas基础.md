# Pandas基础

>Pandas是一个Python数据分析工具包  
>提供了高性能、易于使用的数据结构，用于数据清理、数据转换、数据可视化、数据模型化等操作。  
>Pandas提供了多种数据结构，包括Series、DataFrame、Panel

## Series

>Series是一个一维数组，可以包含任意类型数据，可以指定索引

## DataFrame

>一个表格型的数据结构，它含有一组有序的列，每列可以是不同的值类型  
>DataFrame可以看做由多个Series组成的字典  

### 创建DataFrame

>DataFrame的创建，可以采用字典、列表、Series等数据结构  

1. data为一个字典包含数组的形式，frame的index可自动生成  
`frame = pd.DataFrame(data)`  

2. 设置索引  
`frame = pd.DataFrame(data, index=['a', 'b', 'c', 'd'])`

3. 设置列名  
`frame = pd.DataFrame(data, index=['a', 'b', 'c', 'd'], columns=['one', 'two', 'three', 'four'])`

### 获取数据

在 Pandas 中，`[]`、`loc`、`iloc`、`at`、`iat` 等等 是常用的数据访问和选择方法，它们各有不同的用途和适用场景。以下是它们的区别和用法总结：

---

#### 1. **`[]`**

- **功能**: 基本的索引操作符，用于快速选择行或列。
- **特点**:
  - 如果传入的是单个值（如字符串），会选择列。
  - 如果传入的是切片或布尔数组，则会选择行。
  - 不支持同时选择行和列。
- **示例**:

  ```python
  df['A']  # 选择列 'A'
  df[0:3]  # 选择前 3 行（基于行号）
  df[df['A'] > 0]  # 使用布尔索引选择满足条件的行
  ```

---

#### 2. **`loc`**

- **功能**: 基于标签（label-based）进行数据选择。
- **特点**:
  - 可以通过行和列的标签名选择数据。
  - 支持同时选择行和列。
  - 切片时包含起始和结束标签。
- **示例**:

  ```python
  df.loc[0]  # 选择索引为 0 的行
  df.loc[0, 'A']  # 选择索引为 0 且列为 'A' 的值
  df.loc[0:2, ['A', 'B']]  # 选择索引为 0 到 2 的行，以及列 'A' 和 'B'
  ```

---

#### 3. **`iloc`**

- **功能**: 基于位置（position-based）进行数据选择。
- **特点**:
  - 通过行号和列号选择数据。
  - 切片时不包含结束位置（与 Python 列表切片规则一致）。
  - 不支持使用标签名。
- **示例**:

  ```python
  df.iloc[0]  # 选择第 0 行
  df.iloc[0, 1]  # 选择第 0 行、第 1 列的值
  df.iloc[0:3, 0:2]  # 选择第 0 到 2 行，第 0 到 1 列的数据
  ```

---

#### 4. **`at`**

- **功能**: 快速访问单个元素（基于标签）。
- **特点**:
  - 比 `loc` 更高效，适用于访问单个值。
  - 需要明确指定行和列的标签。
- **示例**:

  ```python
  df.at[0, 'A']  # 获取索引为 0 且列为 'A' 的值
  df.at[0, 'A'] = 10  # 修改索引为 0 且列为 'A' 的值为 10
  ```

---

#### 5. **`iat`**

- **功能**: 快速访问单个元素（基于位置）。
- **特点**:
  - 比 `iloc` 更高效，适用于访问单个值。
  - 需要明确指定行和列的位置编号。
- **示例**:

  ```python
  df.iat[0, 1]  # 获取第 0 行、第 1 列的值
  df.iat[0, 1] = 10  # 修改第 0 行、第 1 列的值为 10
  ```

---

#### 6. **`ix`**

- **功能**: 一种混合索引器，可以同时处理标签和位置。
- **特点**:
  - #color:red{已被弃用}，推荐使用 `loc` 和 `iloc`。
  - 当索引是整数类型时，容易引起混淆。
- **示例**:

  ```python
  df.ix[0, 'A']  # 选择索引为 0 且列为 'A' 的值（已废弃）
  ```

#### 7. **`query()` 方法**

- **功能**: 使用字符串表达式来过滤数据。
- **特点**:
  - 对于复杂的条件过滤非常有用。
  - 提供了一种更加直观的方式来构建查询语句。
- **示例**:

  ```python
  df.query('A > B')  # 选择 'A' 列大于 'B' 列的所有行
  ```

#### 8. **布尔索引(Boolean Indexing)**

- **功能**: 直接使用布尔条件来筛选数据。
- **特点**:
  - 非常灵活，可以根据多个条件进行筛选。
  - 可以与 `&` (和)、`|` (或)、`~` (非) 等逻辑运算符结合使用。
- **示例**:

  ```python
  df[df['A'] > 0]  # 选择 'A' 列值大于 0 的所有行
  df[(df['A'] > 0) & (df['B'] < 10)]  # 多条件筛选
  ```

#### 9. **`where()` 方法**

- **功能**: 根据条件替换不符合条件的数据为 NaN 或指定值，而不是移除它们。
- **特点**:
  - 返回的是一个与原始 DataFrame 形状相同的 DataFrame。
  - 可用于条件格式化或数据清洗。
- **示例**:

  ```python
  df.where(df['A'] > 0, other=-1)  # 将 'A' 列小于等于 0 的值对应的行替换为 -1
  ```

#### 10. **`mask()` 方法**

- **功能**: 类似于 `where()`，但作用相反。它根据条件替换符合条件的数据。
- **特点**:
  - 可用于反转条件应用的结果。
- **示例**:

  ```python
  df.mask(df['A'] > 0, other=-1)  # 将 'A' 列大于 0 的值对应的行替换为 -1
  ```

#### 11. **`xs()` 方法**

- **功能**: 从 MultiIndex（多级索引）DataFrame 中选取单个交叉部分。
- **特点**:
  - 特别适用于处理具有多层索引的数据集。
- **示例**:

  ```python
  df.xs('label', level='level_name')  # 从多级索引中选择特定级别的数据
  ```

---

#### 总结对比

| 方法             | 索引方式                | 数据选择范围                       | 是否支持条件过滤 | 是否支持切片 | 是否高效 | 适用场景                                     |
|------------------|-------------------------|------------------------------------|------------------|--------------|----------|---------------------------------------------|
| **`[]`**        | 标签或位置              | 单列、多行或布尔索引               | 是               | 是           | 一般     | 快速选择列或基于布尔条件筛选行             |
| **`loc`**       | 标签                    | 行、列或行列交叉                   | 是               | 是（含两端） | 一般     | 按标签选择行和列                           |
| **`iloc`**      | 位置                    | 行、列或行列交叉                   | 否               | 是（不含尾端）| 一般     | 按位置选择行和列                           |
| **`at`**        | 标签                    | 单个元素                          | 否               | 否           | 高效     | 快速访问单个值（基于标签）                 |
| **`iat`**       | 位置                    | 单个元素                          | 否               | 否           | 高效     | 快速访问单个值（基于位置）                 |
| **`ix`**        | 标签或位置（混用）      | 行、列或行列交叉                   | 是               | 是           | 已弃用   | 不推荐使用                                 |
| **`query()`**   | 条件表达式              | 基于条件筛选的行                  | 是               | 否           | 一般     | 使用字符串表达式进行复杂条件过滤           |
| **布尔索引**    | 布尔条件                | 基于条件筛选的行                  | 是               | 否           | 一般     | 使用逻辑条件直接筛选行                     |
| **`where()`**   | 条件表达式              | 替换不符合条件的数据为 NaN 或指定值| 是               | 否           | 一般     | 数据清洗或条件格式化                       |
| **`mask()`**    | 条件表达式              | 替换符合条件的数据为 NaN 或指定值  | 是               | 否           | 一般     | 反转条件应用的结果                         |
| **`xs()`**      | 多级索引标签            | 从 MultiIndex 中选取单个交叉部分   | 是               | 否           | 一般     | 处理多级索引数据集                         |

---

#### 使用建议

1. **基本选择 (`[]`)**
   - 最常用的方法之一，适合快速选择列或切片行。
   - 不支持同时选择行和列，功能相对简单。

2. **标签选择 (`loc` / `at`)**
   - 主要用于按标签操作数据。
   - `loc` 支持多行多列选择，`at` 则专为单个元素优化，速度更快。

3. **位置选择 (`iloc` / `iat`)**
   - 主要用于按位置操作数据。
   - `iloc` 支持多行多列选择，`iat` 则专为单个元素优化，速度更快。

4. **条件筛选 (`query()` / 布尔索引)**
   - `query()` 提供了一种更直观的方式编写复杂条件表达式。
   - 布尔索引更加灵活，但需要手动构造条件表达式。

5. **数据替换 (`where()` / `mask()`)**
   - `where()` 和 `mask()` 类似，但作用相反：
     - `where()` 替换不符合条件的数据。
     - `mask()` 替换符合条件的数据。
   - 适用于数据清洗或条件格式化。

6. **多级索引 (`xs()`)**
   - 特别适用于处理具有多层索引的数据集。
   - 能够快速提取特定级别的数据。

7. **避免使用ix**
   因为它已被弃用,推荐使用iloc。  
